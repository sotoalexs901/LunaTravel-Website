<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rastreo | Luna Travel</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- HEADER -->
    <header class="navbar">
      <div class="container">
        <a href="/" class="logo">Luna Travel</a>
        <nav>
          <ul class="menu">
            <li><a href="/servicios">Servicios</a></li>
            <li><a href="/precios">Precios</a></li>
            <li><a href="/tracking" class="active">Rastreo</a></li>
            <li><a href="/contacto">Contáctanos</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main class="tracking-container">
      <h1>Rastrea tu equipaje</h1>
      <p>
        Consulta el estado y ubicación de tu equipaje ingresando el número de
        orden.
      </p>

      <div class="tracking-form">
        <input
          type="text"
          id="orderNumber"
          placeholder="Ejemplo: LT-1234"
          required
        />
        <button id="buscarBtn">Buscar</button>
      </div>

      <div id="resultado" class="tracking-result"></div>
    </main>

    <!-- FIREBASE Y FIRESTORE -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

      // 🔥 Configuración de Firebase (usar variables de entorno si el build lo permite)
      const firebaseConfig = {
        apiKey: "AIzaSyC...TU_API_KEY...",  // Reemplaza por tu API key real
        authDomain: "lunatrack-95199.firebaseapp.com",
        projectId: "lunatrack-95199",
      };

      // Inicializar Firebase y Firestore
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Función principal
      async function buscarEquipaje() {
        const orderId = document.getElementById("orderNumber").value.trim();
        const resultado = document.getElementById("resultado");

        if (!orderId) {
          resultado.innerHTML = "<p>Por favor ingresa un número de orden.</p>";
          return;
        }

        try {
          const docRef = doc(db, "luggage", orderId);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            const data = docSnap.data();
            resultado.innerHTML = `
              <div class="card">
                <p><strong>Estado:</strong> ${data.estado}</p>
                <p><strong>Ubicación:</strong> ${data.ubicacion}</p>
                <p><strong>Última actualización:</strong> ${data.fecha}</p>
              </div>
            `;
          } else {
            resultado.innerHTML = "<p>No se encontró información para ese número de orden.</p>";
          }
        } catch (error) {
          console.error("Error al buscar:", error);
          resultado.innerHTML = "<p>Hubo un error al conectar con la base de datos.</p>";
        }
      }

      // Evento del botón
      document.getElementById("buscarBtn").addEventListener("click", buscarEquipaje);
    </script>
  </body>
</html>
